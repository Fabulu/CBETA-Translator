<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:CbetaTranslator.App.Views"
             xmlns:ae="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
             x:Class="CbetaTranslator.App.Views.ReadableTabView">

	<!-- Only local fallback keys that DON'T collide with your global theme tokens -->
	<UserControl.Resources>
		<SolidColorBrush x:Key="SplitterBrush" Color="#FFD1D1D1"/>
		<SolidColorBrush x:Key="PanelBorderFallback" Color="#FFE8E8E8"/>
	</UserControl.Resources>

	<UserControl.Styles>
		<!-- Keep AvaloniaEdit theme include -->
		<StyleInclude Source="avares://AvaloniaEdit/Themes/Fluent/AvaloniaEdit.xaml" />

		<!-- Inner AvaloniaEdit (inside your wrapper) must use global dynamic tokens -->
		<Style Selector="local|AnnotatedTextEditor ae|TextEditor">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Foreground" Value="{DynamicResource TextFg}"/>
			<Setter Property="FontFamily" Value="Consolas"/>
			<Setter Property="WordWrap" Value="True"/>
			<Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
			<Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
		</Style>
	</UserControl.Styles>

	<!-- Find bar row removed -->
	<Grid RowDefinitions="Auto,*,Auto">

		<!-- Row 0: top action bar -->
		<DockPanel Grid.Row="0"
				   Margin="0,0,0,8"
				   LastChildFill="True">

			<StackPanel Orientation="Horizontal"
						Spacing="8"
						DockPanel.Dock="Left">
				<Button Name="BtnAddCommunityNote"
						Content="Add community note"
						Focusable="False"/>
			</StackPanel>

			<CheckBox Name="ChkZenText"
					  DockPanel.Dock="Right"
					  Content="Zen text"
					  VerticalAlignment="Center"
					  Focusable="False"/>

			<Border/>
		</DockPanel>

		<!-- Row 1: two readable panes -->
		<Grid Grid.Row="1" ColumnDefinitions="1*,Auto,2*" Margin="0">

			<Border Grid.Column="0"
					Background="{DynamicResource XmlViewerBg}"
					BorderBrush="{DynamicResource XmlViewerBorder}"
					BorderThickness="1"
					CornerRadius="6">
				<Grid RowDefinitions="Auto,*">
					<Border Background="{DynamicResource XmlViewerBg}" Padding="8">
						<TextBlock Text="Original (read-only)" Classes="muted"/>
					</Border>

					<local:AnnotatedTextEditor Name="EditorOriginal"
											   Grid.Row="1"/>
				</Grid>
			</Border>

			<GridSplitter Grid.Column="1"
						  Width="6"
						  Background="{DynamicResource SplitterBrush}"
						  ResizeDirection="Columns"
						  ResizeBehavior="PreviousAndNext"/>

			<Border Grid.Column="2"
					Background="{DynamicResource XmlViewerBg}"
					BorderBrush="{DynamicResource XmlViewerBorder}"
					BorderThickness="1"
					CornerRadius="6">
				<Grid RowDefinitions="Auto,*">
					<Border Background="{DynamicResource XmlViewerBg}" Padding="8">
						<TextBlock Text="Translated (readable view)" Classes="muted"/>
					</Border>

					<local:AnnotatedTextEditor Name="EditorTranslated"
											   Grid.Row="1"/>
				</Grid>
			</Border>

		</Grid>

		<!-- Row 2: notes panel -->
		<Border Grid.Row="2"
				Name="NotesPanel"
				IsVisible="False"
				Background="{DynamicResource ControlBg}"
				BorderBrush="{DynamicResource BorderBrush}"
				BorderThickness="1"
				CornerRadius="8"
				Margin="0,8,0,0"
				Padding="10">

			<Grid RowDefinitions="Auto,*" ColumnDefinitions="*,Auto">
				<TextBlock Name="NotesHeader"
						   Grid.Row="0"
						   Grid.Column="0"
						   FontWeight="SemiBold"
						   Text="Note" />

				<StackPanel Grid.Row="0"
							Grid.Column="1"
							Orientation="Horizontal"
							Spacing="6">
					<Button Name="BtnDeleteCommunityNote"
							Content="Delete"
							Padding="10,2"
							Focusable="False"
							IsVisible="False"/>
					<Button Name="BtnCloseNotes"
							Content="✕"
							Padding="8,2"
							Focusable="False"/>
				</StackPanel>

				<ScrollViewer Grid.Row="1"
							  Grid.ColumnSpan="2"
							  MaxHeight="160"
							  VerticalScrollBarVisibility="Auto"
							  HorizontalScrollBarVisibility="Disabled">
					<TextBox Name="NotesBody"
							 IsReadOnly="True"
							 AcceptsReturn="True"
							 TextWrapping="Wrap"
							 Background="Transparent"
							 BorderThickness="0"/>
				</ScrollViewer>
			</Grid>

		</Border>

	</Grid>
</UserControl>